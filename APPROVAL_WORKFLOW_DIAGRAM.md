# Approval Workflow - Visual Diagram

## ğŸ”„ Complete Approval Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER SUBMITS FORM                           â”‚
â”‚                  (Public Form - No Login)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  FORM SUBMISSION CREATED                        â”‚
â”‚  â€¢ Status: "pending"                                            â”‚
â”‚  â€¢ Data: name, phone, address, aadhar                           â”‚
â”‚  â€¢ Stored in: form_submissions table                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ADMIN VIEWS "ALL SUBMISSIONS"                      â”‚
â”‚  â€¢ Sees pending submission                                      â”‚
â”‚  â€¢ Clicks "Approve" button                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 APPROVAL DIALOG OPENS                           â”‚
â”‚  â€¢ Shows applicant details                                      â”‚
â”‚  â€¢ Shows preferred floor (if specified)                         â”‚
â”‚  â€¢ Dropdown: Select Room                                        â”‚
â”‚    - Preferred floor rooms listed first                         â”‚
â”‚    - Other floor rooms listed below                             â”‚
â”‚    - Shows available beds for each room                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ADMIN SELECTS ROOM & CLICKS                        â”‚
â”‚                  "APPROVE & ASSIGN"                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           BACKEND: updateFormSubmissionStatus()                 â”‚
â”‚                                                                 â”‚
â”‚  Step 1: Validate User Authentication                           â”‚
â”‚  â”œâ”€ Check if user is logged in                                  â”‚
â”‚  â””â”€ Get user ID                                                 â”‚
â”‚                                                                 â”‚
â”‚  Step 2: Fetch Submission Details                               â”‚
â”‚  â”œâ”€ Query: form_submissions WHERE id = submissionId             â”‚
â”‚  â””â”€ Get: name, phone, address, aadhar                           â”‚
â”‚                                                                 â”‚
â”‚  Step 3: Validate Room                                          â”‚
â”‚  â”œâ”€ Query: rooms WHERE id = roomId                              â”‚
â”‚  â”œâ”€ Check: Room exists?                                         â”‚
â”‚  â””â”€ Check: Room has capacity? (occupied < capacity)             â”‚
â”‚                                                                 â”‚
â”‚  Step 4: Find Next Available Bed                                â”‚
â”‚  â”œâ”€ Query: tenants WHERE room_id = roomId                       â”‚
â”‚  â”œâ”€ Get occupied bed numbers: [1, 3]                            â”‚
â”‚  â”œâ”€ Loop through 1 to capacity (e.g., 1-4)                      â”‚
â”‚  â””â”€ Find first available: 2 âœ“                                   â”‚
â”‚                                                                 â”‚
â”‚  Step 5: Create Tenant                                          â”‚
â”‚  â”œâ”€ Call: createTenant()                                        â”‚
â”‚  â”œâ”€ Insert into: tenants table                                  â”‚
â”‚  â”œâ”€ Data:                                                       â”‚
â”‚  â”‚   â€¢ room_id: selected room                                   â”‚
â”‚  â”‚   â€¢ name: from submission                                    â”‚
â”‚  â”‚   â€¢ phone: from submission                                   â”‚
â”‚  â”‚   â€¢ address: from submission                                 â”‚
â”‚  â”‚   â€¢ aadhar: from submission                                  â”‚
â”‚  â”‚   â€¢ bed_no: 2 (auto-assigned)                                â”‚
â”‚  â”‚   â€¢ join_date: today's date                                  â”‚
â”‚  â””â”€ Validations:                                                â”‚
â”‚      â€¢ Unique Aadhar (database constraint)                      â”‚
â”‚      â€¢ Unique bed per room (database constraint)                â”‚
â”‚      â€¢ Bed number within capacity                               â”‚
â”‚                                                                 â”‚
â”‚  Step 6: Update Submission Status                               â”‚
â”‚  â”œâ”€ Update: form_submissions                                    â”‚
â”‚  â”œâ”€ Set: status = 'approved'                                    â”‚
â”‚  â”œâ”€ Set: assigned_room_id = roomId                              â”‚
â”‚  â”œâ”€ Set: processed_at = now()                                   â”‚
â”‚  â””â”€ Set: processed_by = userId                                  â”‚
â”‚                                                                 â”‚
â”‚  Step 7: Return Success                                         â”‚
â”‚  â””â”€ Return: true                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          DATABASE TRIGGER: Update Room Occupancy                â”‚
â”‚  â€¢ Automatically counts tenants in room                         â”‚
â”‚  â€¢ Updates room.occupied field                                  â”‚
â”‚  â€¢ Example: 2 â†’ 3 (one more tenant)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FRONTEND: Success Response                         â”‚
â”‚  â€¢ Toast notification: "Application approved! Tenant has been   â”‚
â”‚    added to the room."                                          â”‚
â”‚  â€¢ Close approval dialog                                        â”‚
â”‚  â€¢ Reset selected room                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 FRONTEND: Refresh Data                          â”‚
â”‚  â€¢ Call: loadData()                                             â”‚
â”‚  â€¢ Fetch: getAllFormSubmissions()                               â”‚
â”‚  â€¢ Fetch: getAllRooms()                                         â”‚
â”‚  â€¢ Update state with fresh data                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UI UPDATES                                   â”‚
â”‚                                                                 â”‚
â”‚  Form Submissions Page:                                         â”‚
â”‚  â”œâ”€ Submission status: "Pending" â†’ "Approved" âœ“                 â”‚
â”‚  â”œâ”€ Badge color: Gray â†’ Blue                                    â”‚
â”‚  â””â”€ Assigned room shown                                         â”‚
â”‚                                                                 â”‚
â”‚  Room Management Page:                                          â”‚
â”‚  â”œâ”€ Room 101 occupancy: 2/4 â†’ 3/4                               â”‚
â”‚  â”œâ”€ Available beds: 2 â†’ 1                                       â”‚
â”‚  â”œâ”€ New tenant appears in tenant list:                          â”‚
â”‚  â”‚   â€¢ Name: John Doe                                           â”‚
â”‚  â”‚   â€¢ Bed: 2                                                   â”‚
â”‚  â”‚   â€¢ Phone: 1234567890                                        â”‚
â”‚  â”‚   â€¢ Aadhar: 123456789012                                     â”‚
â”‚  â””â”€ Status badge: "Available" or "Full" (if capacity reached)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Bed Assignment Logic

### Example: 4-Sharing Room

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ROOM 101 (4-Sharing)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Initial State:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ Bed â”‚  â”‚ Bed â”‚  â”‚ Bed â”‚  â”‚ Bed â”‚                         â”‚
â”‚  â”‚  1  â”‚  â”‚  2  â”‚  â”‚  3  â”‚  â”‚  4  â”‚                         â”‚
â”‚  â”‚ âœ“   â”‚  â”‚ âœ—   â”‚  â”‚ âœ“   â”‚  â”‚ âœ—   â”‚                         â”‚
â”‚  â”‚Aliceâ”‚  â”‚Emptyâ”‚  â”‚ Bob â”‚  â”‚Emptyâ”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                              â”‚
â”‚  Occupied: [1, 3]                                            â”‚
â”‚  Available: [2, 4]                                           â”‚
â”‚  Next Bed: 2 (first available)                               â”‚
â”‚                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  After Approval (John Doe):                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ Bed â”‚  â”‚ Bed â”‚  â”‚ Bed â”‚  â”‚ Bed â”‚                         â”‚
â”‚  â”‚  1  â”‚  â”‚  2  â”‚  â”‚  3  â”‚  â”‚  4  â”‚                         â”‚
â”‚  â”‚ âœ“   â”‚  â”‚ âœ“   â”‚  â”‚ âœ“   â”‚  â”‚ âœ—   â”‚                         â”‚
â”‚  â”‚Aliceâ”‚  â”‚ Johnâ”‚  â”‚ Bob â”‚  â”‚Emptyâ”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                              â”‚
â”‚  Occupied: [1, 2, 3]                                         â”‚
â”‚  Available: [4]                                              â”‚
â”‚  Next Bed: 4 (first available)                               â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš ï¸ Error Scenarios

### Scenario 1: Room Full

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin tries to approve submission for Room 101              â”‚
â”‚  Room 101: 4/4 beds occupied (FULL)                          â”‚
â”‚                                                              â”‚
â”‚  Backend Check:                                              â”‚
â”‚  if (room.occupied >= room.capacity) {                       â”‚
â”‚    throw new Error('Room is at full capacity');             â”‚
â”‚  }                                                           â”‚
â”‚                                                              â”‚
â”‚  Result:                                                     â”‚
â”‚  âŒ Error toast: "Room is at full capacity"                  â”‚
â”‚  âŒ Submission remains "Pending"                             â”‚
â”‚  âŒ No tenant created                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Scenario 2: Duplicate Aadhar

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Existing Tenant: Alice (Aadhar: 123456789012)               â”‚
â”‚  New Submission: Bob (Aadhar: 123456789012) â† Same!          â”‚
â”‚                                                              â”‚
â”‚  Backend Check:                                              â”‚
â”‚  Database constraint: UNIQUE (aadhar)                        â”‚
â”‚                                                              â”‚
â”‚  Result:                                                     â”‚
â”‚  âŒ Error toast: "This Aadhar number is already registered"  â”‚
â”‚  âŒ Submission remains "Pending"                             â”‚
â”‚  âŒ No tenant created                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Scenario 3: Bed Already Occupied

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Room 101: Alice in Bed 1, Bob in Bed 2                      â”‚
â”‚  System tries to assign new tenant to Bed 1                  â”‚
â”‚                                                              â”‚
â”‚  Backend Check:                                              â”‚
â”‚  Database constraint: UNIQUE (room_id, bed_no)               â”‚
â”‚                                                              â”‚
â”‚  Result:                                                     â”‚
â”‚  âŒ Error: "This bed number is already occupied"             â”‚
â”‚  âŒ System automatically finds next available bed (Bed 3)    â”‚
â”‚  âœ… Tenant assigned to Bed 3 instead                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â”‚  (Browser)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Click "Approve & Assign"
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Frontend (React)                           â”‚
â”‚  â€¢ handleConfirmApprove()                               â”‚
â”‚  â€¢ Validate room selection                              â”‚
â”‚  â€¢ Call API: updateFormSubmissionStatus()               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. API Request
       â”‚    POST /api/submissions/:id/status
       â”‚    Body: { status: 'approved', roomId: '...' }
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Backend (Supabase)                         â”‚
â”‚  â€¢ Authenticate user                                    â”‚
â”‚  â€¢ Fetch submission details                             â”‚
â”‚  â€¢ Validate room capacity                               â”‚
â”‚  â€¢ Find next available bed                              â”‚
â”‚  â€¢ Create tenant record                                 â”‚
â”‚  â€¢ Update submission status                             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. Database Operations
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Database (PostgreSQL)                         â”‚
â”‚  â€¢ INSERT INTO tenants (...)                            â”‚
â”‚  â€¢ UPDATE form_submissions SET status = 'approved'      â”‚
â”‚  â€¢ TRIGGER: Update room occupancy                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. Success Response
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Frontend (React)                           â”‚
â”‚  â€¢ Show success toast                                   â”‚
â”‚  â€¢ Close dialog                                         â”‚
â”‚  â€¢ Refresh data (submissions + rooms)                   â”‚
â”‚  â€¢ Update UI                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. UI Updates
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â”‚  (Browser)  â”‚
â”‚  â€¢ Sees "Approved" badge                                â”‚
â”‚  â€¢ Sees tenant in Room Management                       â”‚
â”‚  â€¢ Sees updated occupancy                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Security & Validation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   VALIDATION LAYERS                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Layer 1: Frontend Validation                               â”‚
â”‚  â”œâ”€ Room must be selected                                   â”‚
â”‚  â”œâ”€ Cannot select disabled header items                     â”‚
â”‚  â””â”€ User must be authenticated                              â”‚
â”‚                                                             â”‚
â”‚  Layer 2: Backend Validation                                â”‚
â”‚  â”œâ”€ User authentication check                               â”‚
â”‚  â”œâ”€ Submission exists check                                 â”‚
â”‚  â”œâ”€ Room exists check                                       â”‚
â”‚  â”œâ”€ Room capacity check                                     â”‚
â”‚  â””â”€ Bed number range check                                  â”‚
â”‚                                                             â”‚
â”‚  Layer 3: Database Constraints                              â”‚
â”‚  â”œâ”€ UNIQUE (aadhar) - Prevents duplicate registrations      â”‚
â”‚  â”œâ”€ UNIQUE (room_id, bed_no) - Prevents bed conflicts       â”‚
â”‚  â”œâ”€ FOREIGN KEY (room_id) - Ensures room exists             â”‚
â”‚  â””â”€ CHECK (bed_no > 0) - Ensures valid bed number           â”‚
â”‚                                                             â”‚
â”‚  Layer 4: Row Level Security (RLS)                          â”‚
â”‚  â”œâ”€ Only admins can approve submissions                     â”‚
â”‚  â”œâ”€ Only admins can create tenants                          â”‚
â”‚  â””â”€ Audit trail: processed_by, processed_at                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Visual Guide Version**: 1.0  
**Last Updated**: 2025-01-26  
**Status**: âœ… Complete
